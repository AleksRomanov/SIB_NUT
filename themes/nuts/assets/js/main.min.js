(function () {
    'use strict';

    const swiperProductsPacking = () => {
      new Swiper('.catalog__wrapper-box-packing', {
        spaceBetween: 8,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        },
        breakpoints: {
          1200: {
            slidesPerView: 7,
            allowTouchMove: false
          },
          // 768: {
          //     // slidesPerView: 7
          // },
          // 576: {
          //     slidesPerView: 1,
          //     // height: 1024,
          // },
          320: {
            allowTouchMove: true,
            slidesPerView: 1
          }
        }
      });
    };

    const swiperAbout = () => {
      new Swiper('.about__container', {
        // slidesPerView: 3,
        spaceBetween: 8,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        },
        breakpoints: {
          1200: {
            // height: 800,
            slidesPerView: 3
          },
          768: {
            slidesPerView: 1 // height: 1024,

          },
          576: {
            slidesPerView: 1 // height: 1024,

          },
          320: {
            height: 640
          }
        }
      });
    };

    const swiperQuality = () => {
      new Swiper('.quality__wrapper', {
        spaceBetween: 20,
        slidesPerView: 4,
        // width: 1280,
        // slidesPerColumnFill: 'row',
        // slidesPerColumn: 4,
        // autoHeight: true,
        // height: 1280,
        breakpoints: {
          1790: {
            direction: 'vertical',
            slidesPerView: 4,
            height: 1280
          },
          1200: {
            direction: 'vertical',
            height: 1400,
            // width: 1280,
            slidesPerView: 4
          },
          768: {
            direction: 'horizontal',
            slidesPerView: 1 // height: 1200,

          },
          320: {
            direction: 'horizontal',
            slidesPerView: 1,
            height: 640
          }
        },
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        }
      });
    };

    const swiperSertificates = () => {
      new Swiper('.sertificates__swiper', {
        slidesPerView: 3,
        spaceBetween: 10,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        },
        breakpoints: {
          1200: {
            slidesPerView: 3 // height: 1024,

          },
          768: {
            slidesPerView: 2
          },
          576: {
            slidesPerView: 1
          },
          320: {
            slidesPerView: 1
          }
        }
      });
    };

    const scrollTop = () => {
      $(window).scroll(function () {
        if ($(this).scrollTop() > $(this).height()) {
          $('.top').addClass('active');
        } else {
          $('.top').removeClass('active');
        }
      });
      $('.top').click(function () {
        $('html, body').stop().animate({
          scrollTop: 0
        }, 'slow', 'swing');
      });
      $('.scroll-to-teaser—js').click(function () {
        $('html, body').stop().animate({
          scrollTop: 0
        }, 'slow', 'swing');
      });
    };

    const scrollPages = () => {
      // Скроллер
      var currentYPosition = function () {
        // Firefox, Chrome, Opera, Safari
        if (self.pageYOffset) {
          return self.pageYOffset;
        } // Internet Explorer 6 - standards mode


        if (document.documentElement && document.documentElement.scrollTop) {
          return document.documentElement.scrollTop;
        } // Internet Explorer 6, 7 and 8


        if (document.body.scrollTop) {
          return document.body.scrollTop;
        }

        return 0;
      };

      var elmYPosition = function (eID) {
        var elm = document.getElementById(eID);
        var y = elm.offsetTop;
        var node = elm;

        while (node.offsetParent && node.offsetParent !== document.body) {
          node = node.offsetParent;
          y += node.offsetTop;
        }

        return y;
      };

      var smoothScroll = function (eID) {
        var startY = currentYPosition();
        var stopY = elmYPosition(eID);
        var distance = stopY > startY ? stopY - startY : startY - stopY;

        if (distance < 100) {
          scrollTo(0, stopY);
          return;
        }

        var speed = Math.round(distance / 100);

        if (speed >= 10) {
          speed = 30;
        }

        var timer = 0;
        var step = Math.round(distance / 25);
        var leapY = stopY > startY ? startY + step : startY - step;

        if (stopY > startY) {
          for (var i = startY; i < stopY; i += step) {
            var bottomScrollHandler = 'window.scrollTo(0, ' + leapY + ')';
            setTimeout(bottomScrollHandler, timer * speed);
            leapY += step;

            if (leapY > stopY) {
              leapY = stopY;
            }

            timer++;
          }

          return;
        }

        for (var j = startY; j > stopY; j -= step) {
          var topScrollHandler = 'window.scrollTo(0, ' + leapY + ')';
          setTimeout(topScrollHandler, timer * speed);
          leapY -= step;

          if (leapY < stopY) {
            leapY = stopY;
          }

          timer++;
        }
      };

      var scrollSetup = function (scrollButton, scrollDestination) {
        if (scrollButton) {
          scrollButton.addEventListener('click', function () {
            smoothScroll(scrollDestination);
          });
        }
      };

      var scrollSettings = {
        // teaser: {
        //     scrollButtonClass: '.my-menu__link--teaser',
        //     scrollDestinationID: 'section_teaser'
        // },
        teaser: {
          scrollButtonClass: '.link-to-teaser',
          scrollDestinationID: 'section_teaser'
        },
        about: {
          scrollButtonClass: '.my-menu__link--about',
          scrollDestinationID: 'section_about'
        },
        products: {
          scrollButtonClass: '.my-menu__link--products',
          scrollDestinationID: 'section_products'
        },
        catalog: {
          scrollButtonClass: '.my-menu__link--catalog',
          scrollDestinationID: 'section_catalog'
        },
        quality: {
          scrollButtonClass: '.my-menu__link--quality',
          scrollDestinationID: 'section_quality'
        },
        gallery: {
          scrollButtonClass: '.my-menu__link--gallery',
          scrollDestinationID: 'section_gallery'
        },
        map: {
          scrollButtonClass: '.my-menu__link--map',
          scrollDestinationID: 'section_map'
        },
        partners: {
          scrollButtonClass: '.my-menu__link--partners',
          scrollDestinationID: 'section_partners'
        },
        certificates: {
          scrollButtonClass: '.my-menu__link--certificates',
          scrollDestinationID: 'section_certificates'
        },
        contacts: {
          scrollButtonClass: '.button--contacts',
          scrollDestinationID: 'contact'
        }
      };

      for (var key in scrollSettings) {
        var scrollButtons = document.querySelectorAll(scrollSettings[key].scrollButtonClass);

        if (scrollButtons) {
          var sectionID = scrollSettings[key].scrollDestinationID;

          for (var i = 0; i <= scrollButtons.length - 1; i++) {
            scrollSetup(scrollButtons[i], sectionID);
          }
        }
      }

      var scrollAndShowSettings = {
        buttons: {
          scrollButtonClass: '.products__contact-button',
          scrollDestinationID: 'section_catalog'
        }
      };

      var scrollAndShowSetup = function (index, scrollButton, scrollDestination) {
        if (scrollButton) {
          var showDestinations = document.querySelectorAll('.catalog__wrapper-controls-item');
          scrollButton.addEventListener('click', function () {
            smoothScroll(scrollDestination); // var index = scrollButton.indexOf();

            showDestinations[index].click();
          });
        }
      };

      for (var key in scrollAndShowSettings) {
        var scrollAndShowButtons = document.querySelectorAll(scrollAndShowSettings[key].scrollButtonClass);

        if (scrollAndShowButtons) {
          var sectionID = scrollAndShowSettings[key].scrollDestinationID;

          for (var i = 0; i <= scrollAndShowButtons.length - 1; i++) {
            scrollAndShowSetup(i, scrollAndShowButtons[i], sectionID);
          }
        }
      }
    };

    const swiperProducts = () => {
      $('.products__slide').each(function () {
        var ths = $(this),
            thsh = ths.find('.products__slide-data').outerHeight();
        ths.find('.products__slide-image').css('min-height', thsh);
      });
      var mySwiper = new Swiper('.products__swiper', {
        slidesPerView: 3,
        spaceBetween: 0,
        direction: 'horizontal',
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev'
        },
        breakpoints: {
          1200: {
            // height: 800,
            slidesPerView: 3
          },
          768: {
            slidesPerView: 2 // height: 1024,

          },
          576: {
            slidesPerView: 1 // height: 1024,

          },
          320: {
            slidesPerView: 1
          }
        },
        on: {
          init: function () {// mySwiper.update();
            // mySwiper.destroy();
          }
        }
      });
    };

    const salAnimation = () => {
      window.sal(); // if (document.querySelector(`.sal--js`)) {
      //     // Запуск анимиции dash иконок при попадании во вьюпорт
      //     let salAnimatedElements = document.querySelectorAll(`.sal--js`);
      //
      //     salAnimatedElements.forEach(function (salElement) {
      //         salElement.addEventListener(`sal:in`, ({detail}) => {
      //             salElement.classList.add(`icons__animated--js`);
      //         });
      //     });
      //
      //     // Удаление анимирующего класса у иконок после окончания анимации для последующего анимирования через ховер или фокус
      //     salAnimatedElements.forEach(function (salElement) {
      //         salElement.addEventListener(`animationend`, () => {
      //             salElement.classList.remove(`icons__animated--js`);
      //         });
      //     });
      // }
    };

    const mmenu = () => {
      let hamburgerMenu = document.querySelector('.hamburger');
      new Mmenu("#my-menu", {
        // "pageScroll": true,
        navbar: {
          title: "Меню"
        },
        extensions: ['theme-black', 'position-right', 'pagedim-black'],
        hooks: {
          "open:start": panel => {
            hamburgerMenu.classList.add('is-active');
            console.log("Started opening pane: ");
          },
          "close:start": panel => {
            hamburgerMenu.classList.remove('is-active');
            console.log("Finished opening panel: ");
          }
        }
      }, {// configuration
      }); // document.addEventListener('click', function (evnt) {
      //     var anchor = evnt.target.closest('a[href^="#/"]');
      //     if (anchor) {
      //         alert('Thank you for clicking, but that\'s a demo link.');
      //         evnt.preventDefault();
      //     }
      // });
    };

    const formsSubmit = () => {
      //E-mail Ajax Send
      $("form").submit(function () {
        //Change
        var th = $(this);
        $.ajax({
          type: "POST",
          url: "/mail.php",
          //Change
          data: th.serialize()
        }).done(function () {
          $(th).find('.success').addClass('activate').css("display", "block").hide().fadeIn();
          setTimeout(function () {
            $(th).find('.success').removeClass('activate').fadeOut();
            th.trigger("reset");
            pageBody.classList.remove('overflow-hidden--js');
          }, 1000);
        });
        return false;
      });
      var feedbackContactButtons = document.querySelectorAll('.contact-button--feedback-js');
      var feedbackPopup = document.querySelector('.feedback-popup');
      var pageBody = document.querySelector('body');
      var feedbackPopupCloseButton = document.querySelector('.feedback-popup__close');
      var KEY_CODE = {
        ESC: 27
      };

      var isEscEvent = function (evt, action) {
        if (evt.keyCode === KEY_CODE.ESC) {
          action();
        }
      };

      function onImageEditorEscPress(evt) {
        isEscEvent(evt, hideFeedback);
      }

      function showFeedback() {
        feedbackPopup.classList.add('popup-show--js');
        pageBody.classList.add('overflow-hidden--js');
        document.addEventListener('keydown', onImageEditorEscPress);
      }

      feedbackContactButtons.forEach(function (contactButton) {
        contactButton.addEventListener('click', function () {
          showFeedback();
        });
      });

      function hideFeedback() {
        feedbackPopup.classList.remove('popup-show--js');
        pageBody.classList.remove('overflow-hidden--js');
        document.removeEventListener('keydown', onImageEditorEscPress);
      }

      feedbackPopupCloseButton.addEventListener('click', function () {
        hideFeedback();
      });
    };

    const formsOrderSubmit = () => {
      //E-mail Ajax Send
      $("form").submit(function () {
        //Change
        var th = $(this);
        $.ajax({
          type: "POST",
          url: "/mail.php",
          //Change
          data: th.serialize()
        }).done(function () {
          $(th).find('.success').addClass('activate').css("display", "block").hide().fadeIn();
          setTimeout(function () {
            $(th).find('.success').removeClass('activate').fadeOut();
            th.trigger("reset");
            pageBody.classList.remove('overflow-hidden--js');
          }, 1000);
        });
        return false;
      });
      var orderSubmitButtons = document.querySelectorAll('.order-button--submit-js');
      var orderPopup = document.querySelector('.order-popup');
      var pageBody = document.querySelector('body');
      var orderPopupCloseButton = document.querySelector('.order-popup__close');
      var KEY_CODE = {
        ESC: 27
      };

      var isEscEvent = function (evt, action) {
        if (evt.keyCode === KEY_CODE.ESC) {
          action();
        }
      };

      function onImageEditorEscPress(evt) {
        isEscEvent(evt, hideFeedback);
      }

      function showFeedback() {
        orderPopup.classList.add('popup-show--js');
        pageBody.classList.add('overflow-hidden--js');
        document.addEventListener('keydown', onImageEditorEscPress);
      }

      orderSubmitButtons.forEach(function (contactButton) {
        contactButton.addEventListener('click', function () {
          showFeedback();
        });
      });

      function hideFeedback() {
        orderPopup.classList.remove('popup-show--js');
        pageBody.classList.remove('overflow-hidden--js');
        document.removeEventListener('keydown', onImageEditorEscPress);
      }

      orderPopupCloseButton.addEventListener('click', function () {
        hideFeedback();
      });
    };

    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    class App {
      static init() {
        if (isSafari) {
          window.console.log(`isSafari`);
        } // if (window.objectFitImages) {
        //   window.objectFitImages();
        // }


        swiperAbout();
        swiperProductsPacking();
        swiperQuality();
        swiperSertificates();
        swiperProducts();
        scrollTop();
        scrollPages();
        salAnimation();
        mmenu();
        formsSubmit();
        formsOrderSubmit();
      }

    }

    App.init();
    window.App = App;

}());
